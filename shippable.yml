language: node_js
node_js:
  - '12.8.0'
env:
  matrix:
    - LINUX_VERSION: ubuntu1404
    - LINUX_VERSION: ubuntu1604
    - LINUX_VERSION: ubuntu1804
build:
  ci:
    - npm ci
    - >
      if [[ "$(./.ci/files-have-changed.sh $SHIPPABLE_COMMIT_RANGE)" == "false" ]]; then
        echo "Skipping Docker build"
      else
        docker build
        --file "./docker/${LINUX_VERSION}.DockerFile"
        --tag "docker-linux:${LINUX_VERSION}"
        .;
      fi
  on_success:
    - >
      if [[ "$(./.ci/files-have-changed.sh $SHIPPABLE_COMMIT_RANGE)" == "false" ]]; then
        echo "Skipping Docker push"
      else
        ./docker/tag_and_push
        "docker-linux:${LINUX_VERSION}"
        "vidavidorra"
        "${BRANCH}"
        "${GIT_TAG_NAME}"
        "${PULL_REQUEST}";
      fi
integrations:
  notifications:
    - integrationName: email
      type: email
      recipients:
        - --last_committer
        - --last_author
      sendConsoleLogs: false
      on_success: change
      on_failure: change
      on_cancel: never
      on_start: never
      on_pull_request: never
  hub:
    - integrationName: docker-hub
      type: docker
